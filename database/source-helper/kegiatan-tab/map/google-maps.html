<!DOCTYPE html>
<html>

<head>
    <title>Indonesia Map Selection (Google Maps)</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <style>
        #map {
            height: 500px;
            width: 100%;
            margin-top: 20px;
        }

        .select-container {
            margin-bottom: 15px;
        }

        .select2-container {
            width: 100% !important;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="container-fluid">

        <div class="form-group row">
            <div class="form-group col-12 select-container">
                <select id="provinsi_id" style="width: 300px;">
                    <option value="">Select Provinsi</option>
                    <option value="51">Bali</option>
                </select>
            </div>
            <div class="form-group col-12 select-container">
                <select id="kabupaten_id" style="width: 300px;">
                    <option value="">Select Kabupaten</option>
                    <option value="5171">Denpasar</option>
                    <option value="5104">Gianyar</option>
                </select>
            </div>
            
        </div>
    </div>


    <div id="map"></div>

    <div class="card">
        <div class="card-head">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#tambahLokasiModal" id="btn-tambah-lokasi"><i class="fas fa-plus"></i> Tambah Lokasi</button>
        </div>
        <div class="card-body table-responsive">
            <table id="table-lokasi" class="table table-striped table-bordered" style="width:100%">
                <thead>
                    <tr>
                        <th>Lokasi</th>
                        <th>Kecamatan</th>
                        <th>Kelurahan/Desa</th>
                        <th>Lat</th>
                        <th>Long</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="table-lokasi-body" class="table-body">
                    <tr class="table-body-nodata text-center" id="no-data-row">
                        <td colspan="6">No data</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <!-- <div class="select-container">
        <select id="kecamatan_id" style="width: 300px;">
            <option value="">Select Kecamatan</option>
            <option value="510403">Gianyar</option>
            <option value="510402">Sukawati</option>
        </select>
    </div>
    <div class="select-container">
        <select id="kelurahan_id" style="width: 300px;">
            <option value="">Select Kelurahan</option>
            <option value="510403">Samplangan</option>
            <option value="510404">Gianyar</option>
        </select>
    </div> -->


    <!-- Modal -->
    <div class="modal fade" id="tambahLokasiModal" tabindex="-1" aria-labelledby="tambahLokasiTitle" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="tambahLokasiTitle">Tambah Lokasi</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="false">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addLokasiForm">
                    <div class="form-group">
                      <label for="lokasi">Lokasi</label>
                      <input type="text" class="form-control" id="lokasi">
                    </div>
                    <div class="form-group">
                      <label for="kecamatan_id">Kecamatan</label>
                      <select class="form-control select2" id="kecamatan_id">
                        <option value="">Select Kecamatan</option>
                        <option value="510403">Gianyar</option>
                        <option value="510402">Sukawati</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="kelurahan_id">Kelurahan/Desa</label>
                      <select class="form-control select2" id="kelurahan_id">
                            <option value="">Select Kelurahan</option>
                            <option value="51040301">Samplangan</option>
                            <option value="51040401">Gianyar</option>
                        </select>
                    </div>
                    <div class="form-group">
                      <label for="lat">Lat</label>
                      <input type="text" class="form-control" id="lat" name="lat">
                    </div>
                    <div class="form-group">
                      <label for="Long">Long</label>
                      <input type="text" class="form-control" id="long" name="long">
                    </div>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" id="btn-simpan-lokasi">Save changes</button>
                </form>
            </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap"></script>
    <script>
        function generateUniqueId() {
            const timestamp = Date.now(); // Current timestamp in milliseconds
            const randomNum = Math.floor(Math.random() * 1000000); // Random number between 0 and 999999
            return `${timestamp}-${randomNum}`;
        }
        const uniqueId = generateUniqueId();
        $(document).ready(function () {
            $('#btn-tambah-lokasi').on('shown.bs.modal', function () {
                    $('#myInput').trigger('focus')
            });
            $('#btn-simpan-lokasi').on('click', function (e) {
                e.preventDefault();


                const lokasi = $('#lokasi').val();
                const kecamatanId = $('#kecamatan_id').val();
                const kecText = $('#kecamatan_id option:selected').text();
                const kelurahanId = $('#kelurahan_id').val();
                const kelText = $('#kelurahan_id option:selected').text();

                const lat = $('#lat').val();
                const long = $('#long').val();
                console.log(lokasi, kecamatanId, kelurahanId, lat, long);
                $('#addLokasiForm').trigger('reset');
                $('#tambahLokasiModal').modal('hide');

                // display submitted data
                $('#table-lokasi-body').append(`
                    <tr id="table-lokasi-body-row-${uniqueId}">
                        <td data-lokasi='${lokasi}'>${lokasi}</td>
                        <td data-kec_id='${kecamatanId}'>${kecText}</td>
                        <td data-kel_id='${kelurahanId}'>${kelText}</td> <
                        <td data-lat='${lat}'>${lat}</td>
                        <td data-long='${long}'>${long}</td>
                        <td><button type="button" class="btn btn-primary btn-sm" id="btn-edit-lokasi-${uniqueId}">Edit</button>
                            <button type="button" class="btn btn-danger btn-sm" id="btn-delete-lokasi-${uniqueId}">Delete</button>
                        </td>
                    </tr>
                `);

                //remove tr nodata
                $('#no-data-row').addClass('d-none');
                

            });

            $('#table-lokasi tbody').on('click', 'button', function () {
                const btn = $(this);
                const uniqueId = btn.attr('id').split('-').pop();
                if (btn.hasClass('btn-danger')) {
                    $('#table-lokasi-body-row-' + uniqueId).remove();
                }
                else if (btn.hasClass('btn-edit')) {
                    $('#tambahLokasiModal').modal('show');
                }
            });

            //delete lokasi row 
            $(`#btn-delete-lokasi-${uniqueId}`).on('click', function (e) {
                e.preventDefault();
                let countRow = $('#table-lokasi-body-row-'+uniqueId).length;
                console.log(countRow);
                $('#table-lokasi-body-row-' + uniqueId).remove();


                if ($(`#table-lokasi-body-row-${uniqueId}`).length == 0) {
                    $('#no-data-row').removeClass('d-none');
                }
            });
        })
    </script>

    <script>
        let map;
        let provinsiLayer = null;
        let kabupatenLayer = null;

        // Function to convert path data to GeoJSON
        function convertPathToGeoJSON(pathData) {
            try {
                const convertedCoordinates = pathData.map(polygon => {
                    return polygon.map(ring => {
                        const convertedRing = ring.map(coord => [ parseFloat(coord[ 1 ]), parseFloat(coord[ 0 ]) ]);
                        // ensure first and last point is same
                        if (convertedRing.length > 0) {
                            const firstCoord = convertedRing[ 0 ]
                            const lastCoord = convertedRing[ convertedRing.length - 1 ]
                            if (firstCoord[ 0 ] !== lastCoord[ 0 ] || firstCoord[ 1 ] !== lastCoord[ 1 ]) {
                                convertedRing.push(firstCoord)
                            }
                        }
                        return convertedRing;
                    })
                })
                return {
                    type: "Feature",
                    geometry: {
                        type: "MultiPolygon",
                        coordinates: convertedCoordinates,
                    }
                };
            } catch (e) {
                console.error("Error parsing or converting path to geojson:", e)
                return null;
            }
        }

        // const baliPath = [ [ [ [ -8.847677028871733, 115.12520303029567 ], [ -8.847734016211913, 115.1249410110189 ], [ -8.847386971431533, 115.1249310006652 ], [ -8.847385012708127, 115.12526199524495 ], [ -8.847677028871733, 115.12520303029567 ] ] ], [ [ [ -8.816724990066234, 115.59463702357984 ], [ -8.816674004801424, 115.59432402623295 ], [ -8.815418975705132, 115.59442202265824 ], [ -8.815486968049065, 115.59461696600023 ], [ -8.816724990066234, 115.59463702357984 ] ] ], [ [ [ -8.804456990897432, 115.52572702578165 ], [ -8.804237005033773, 115.5253729752826 ], [ -8.802460043596135, 115.5257509738284 ], [ -8.803620028741317, 115.52651296670012 ], [ -8.804456990897432, 115.52572702578165 ] ] ], [ [ [ -8.799726007449234, 115.52900500787487 ], [ -8.799809014874079, 115.52882403460163 ], [ -8.799673001407811, 115.52872000822185 ], [ -8.799593959993242, 115.52903701114913 ], [ -8.799726007449234, 115.52900500787487 ] ] ], [ [ [ -8.800556999905591, 115.52749997174635 ], [ -8.800091035972464, 115.5267559976912 ], [ -8.799360011255526, 115.52739998961782 ], [ -8.799762004612795, 115.52806101470414 ], [ -8.800556999905591, 115.52749997174635 ] ] ], [ [ [ -8.799074011556403, 115.52842802083664 ], [ -8.799166004107757, 115.52830203121383 ], [ -8.799056973000859, 115.5282320028048 ], [ -8.798987998597248, 115.52837199397243 ], [ -8.799074011556403, 115.52842802083664 ] ] ], [ [ [ -8.799161955359931, 115.52812200222868 ], [ -8.799168006897958, 115.52798203534269 ], [ -8.79910297332352, 115.5278810261884 ], [ -8.798966040750152, 115.52807398023003 ], [ -8.799161955359931, 115.52812200222868 ] ] ], [ [ [ -8.780478699032741, 115.62976619655278 ], [ -8.780477037984909, 115.62940002678991 ], [ -8.780107967908364, 115.62899602344784 ], [ -8.779894992260047, 115.62932698385323 ], [ -8.780478699032741, 115.62976619655278 ] ] ], [ [ [ -8.779309965282607, 115.61983102618096 ], [ -8.779233002201277, 115.61947797213078 ], [ -8.77854696427099, 115.61902800623761 ], [ -8.778490989567452, 115.61919798619822 ], [ -8.779309965282607, 115.61983102618096 ] ] ], [ [ [ -8.778974025331017, 115.62940125976036 ], [ -8.777082998381676, 115.62982196531155 ], [ -8.776023014250718, 115.6293150372592 ], [ -8.776903040442903, 115.63048200384151 ], [ -8.778974025331017, 115.62940125976036 ] ] ], [ [ [ -8.774191025995044, 115.62306997320078 ], [ -8.774468983956403, 115.62531397865726 ], [ -8.775084983585131, 115.62915500290117 ], [ -8.77675499494704, 115.6257439760037 ], [ -8.774191025995044, 115.62306997320078 ] ] ], [ [ [ -8.773384976235661, 115.49226703499575 ], [ -8.773507031324453, 115.49206597626377 ], [ -8.773247009441938, 115.49196996464218 ], [ -8.773204965236932, 115.4922400301533 ], [ -8.773384976235661, 115.49226703499575 ] ] ], [ [ [ -8.772960979165852, 115.48440799363405 ], [ -8.772752016292536, 115.48381302285279 ], [ -8.772473005225041, 115.4836489667265 ], [ -8.772244023442973, 115.48412402640281 ], [ -8.772960979165852, 115.48440799363405 ] ] ], [ [ [ -8.770645967737163, 115.48728099482203 ], [ -8.77006501109135, 115.48648498869133 ], [ -8.76977095796337, 115.48680801078112 ], [ -8.769992008624257, 115.4872179856216 ], [ -8.770645967737163, 115.48728099482203 ] ] ], [ [ [ -8.76562697460513, 115.18869900325652 ], [ -8.765129966974435, 115.18770999182279 ], [ -8.763992990084375, 115.18817096901512 ], [ -8.764443995593847, 115.18886000258718 ], [ -8.76562697460513, 115.18869900325652 ] ] ], [ [ [ -8.759011588613859, 115.47846445696918 ], [ -8.758302965109717, 115.47785197998493 ], [ -8.757878021953143, 115.4782440286391 ], [ -8.758279959552436, 115.47873996427806 ], [ -8.759011588613859, 115.47846445696918 ] ] ], [ [ [ -8.75897398436188, 115.21438497908353 ], [ -8.758785949611887, 115.21411295574839 ], [ -8.757173943622572, 115.21404398943866 ], [ -8.757315983445853, 115.21431900301972 ], [ -8.75897398436188, 115.21438497908353 ] ] ], [ [ [ -8.754433715643469, 115.47311812410227 ], [ -8.754587005086208, 115.47275198131898 ], [ -8.75421500321983, 115.47232803371183 ], [ -8.753677972160652, 115.47325902088718 ], [ -8.754433715643469, 115.47311812410227 ] ] ], [ [ [ -8.750437013357455, 115.45173601580447 ], [ -8.750332030998383, 115.45153102883395 ], [ -8.75020097459532, 115.45164803422946 ], [ -8.750333040937093, 115.45179999897087 ], [ -8.750437013357455, 115.45173601580447 ] ] ], [ [ [ -8.73782504239183, 115.45479700407851 ], [ -8.737843963228283, 115.45460402665461 ], [ -8.737814008609586, 115.45453003313459 ], [ -8.737672022745631, 115.45471602282623 ], [ -8.73782504239183, 115.45479700407851 ] ] ], [ [ [ -8.73572673969721, 115.21395685772295 ], [ -8.746707038299125, 115.21176702832575 ], [ -8.741422978987242, 115.20053993417069 ], [ -8.729026177116335, 115.21723099701295 ], [ -8.73572673969721, 115.21395685772295 ] ] ], [ [ [ -8.723374030686955, 115.23389600199889 ], [ -8.724296026440477, 115.23259296799117 ], [ -8.723760963097956, 115.23159703537497 ], [ -8.723128039127655, 115.23371402778025 ], [ -8.723374030686955, 115.23389600199889 ] ] ], [ [ [ -8.721402429878207, 115.23951372507841 ], [ -8.736999796603325, 115.23642042596191 ], [ -8.72830524638993, 115.24755630278116 ], [ -8.73108207677636, 115.25065436110997 ], [ -8.74818374038729, 115.21837130229382 ], [ -8.721402429878207, 115.23951372507841 ] ] ], [ [ [ -8.715011875297758, 115.45667139087212 ], [ -8.715070973346702, 115.45608502120685 ], [ -8.714378999890922, 115.45598796996887 ], [ -8.714106024173692, 115.45648697139669 ], [ -8.715011875297758, 115.45667139087212 ] ] ], [ [ [ -8.688151958645925, 115.46567001356036 ], [ -8.712057009723225, 115.44439100534062 ], [ -8.708465002357897, 115.43709899911964 ], [ -8.700668959404918, 115.441377987804 ], [ -8.688151958645925, 115.46567001356036 ] ] ], [ [ [ -8.67216495614774, 115.56323597306172 ], [ -8.769957003412905, 115.62858303318043 ], [ -8.778368956062462, 115.61604403680296 ], [ -8.791219965029303, 115.60599497538787 ], [ -8.80793604431301, 115.60739699327668 ], [ -8.808340037762548, 115.5989160302506 ], [ -8.819457964113749, 115.5882380252647 ], [ -8.799415971569776, 115.52874103706931 ], [ -8.784642970196906, 115.52161499533591 ], [ -8.751908994004872, 115.47537301225474 ], [ -8.748330022312707, 115.45125197010236 ], [ -8.733227980586829, 115.44669396315592 ], [ -8.673702995596784, 115.49037101141307 ], [ -8.67216495614774, 115.56323597306172 ] ] ], [ [ [ -8.665998325562281, 115.46685873024624 ], [ -8.693816993259603, 115.45084900727588 ], [ -8.691149978188946, 115.42908900835111 ], [ -8.663281997965829, 115.45062701682346 ], [ -8.665998325562281, 115.46685873024624 ] ] ], [ [ [ -8.542687037676629, 115.00421400597165 ], [ -8.541965025065775, 115.00411801323584 ], [ -8.541327965113517, 115.00463496333296 ], [ -8.542257990913534, 115.00449398740764 ], [ -8.542687037676629, 115.00421400597165 ] ] ], [ [ [ -8.533527965143424, 115.58464299258017 ], [ -8.533225958411268, 115.58421002926946 ], [ -8.531009981225608, 115.58473503459427 ], [ -8.53254699095088, 115.58599400002306 ], [ -8.533527965143424, 115.58464299258017 ] ] ], [ [ [ -8.527620003860033, 115.57523896720468 ], [ -8.52759799834893, 115.57495800910488 ], [ -8.527318971093674, 115.57504900161015 ], [ -8.527325964221795, 115.57527900592139 ], [ -8.527620003860033, 115.57523896720468 ] ] ], [ [ [ -8.52634498013672, 115.57580501938617 ], [ -8.526380983595512, 115.57566301823374 ], [ -8.526146013227905, 115.5755889842443 ], [ -8.526119022774655, 115.57582203455935 ], [ -8.52634498013672, 115.57580501938617 ] ] ], [ [ [ -8.525744992937064, 115.57678001308714 ], [ -8.52564700190755, 115.57656098320288 ], [ -8.525455035321546, 115.57652798707704 ], [ -8.525421032854393, 115.57692000785208 ], [ -8.525744992937064, 115.57678001308714 ] ] ], [ [ [ -8.525423722726629, 115.57726173584048 ], [ -8.525418964413685, 115.57720653275535 ], [ -8.525319026351948, 115.57720462889064 ], [ -8.525350435174424, 115.57727220574773 ], [ -8.525423722726629, 115.57726173584048 ] ] ], [ [ [ -8.508075027040814, 115.61463896931313 ], [ -8.508650967268323, 115.61551099873364 ], [ -8.50986595674846, 115.61426101933071 ], [ -8.509106031418241, 115.61382003496666 ], [ -8.508075027040814, 115.61463896931313 ] ] ], [ [ [ -8.400720769048238, 115.7118285238673 ], [ -8.400347021597739, 115.71095203470871 ], [ -8.39970202243033, 115.7113690170665 ], [ -8.400336967177243, 115.71241102105182 ], [ -8.400720769048238, 115.7118285238673 ] ] ], [ [ [ -8.172324066102739, 114.45086977911704 ], [ -8.174670238140987, 114.45292024777129 ], [ -8.178754321254907, 114.4464706320141 ], [ -8.172404015832686, 114.44959629233506 ], [ -8.172324066102739, 114.45086977911704 ] ] ], [ [ [ -8.164605586078906, 114.45152385334329 ], [ -8.1672233201001, 114.45191824922786 ], [ -8.167270910424136, 114.45164461071033 ], [ -8.167824133776776, 114.45148994620415 ], [ -8.168261359873881, 114.45093374699488 ], [ -8.164605586078906, 114.45152385334329 ] ] ], [ [ [ -8.163507063300298, 114.44428819324563 ], [ -8.163715980308258, 114.44672238193243 ], [ -8.164993749661782, 114.44661173744178 ], [ -8.165418484175653, 114.44418468667405 ], [ -8.163507063300298, 114.44428819324563 ] ] ], [ [ [ -8.121334450424563, 114.60897430721856 ], [ -8.122880624241365, 114.60921066703872 ], [ -8.123226694156578, 114.60976132372618 ], [ -8.123128087990857, 114.60913452413901 ], [ -8.121334450424563, 114.60897430721856 ] ] ], [ [ [ -8.091936818729202, 114.51487026904769 ], [ -8.095246173671907, 114.52837323433732 ], [ -8.095620304233638, 114.50124400400765 ], [ -8.0933235688276, 114.50435581117176 ], [ -8.091936818729202, 114.51487026904769 ] ] ], [ [ [ -8.061683489301526, 115.18375831229633 ], [ -8.162480862201978, 115.45364624058166 ], [ -8.233446988987321, 115.56050896601603 ], [ -8.324323559084952, 115.6295532343943 ], [ -8.358348995909466, 115.69780200655734 ], [ -8.39351301401435, 115.71160696508949 ], [ -8.432235001044493, 115.68808302960815 ], [ -8.461961834970662, 115.63422652903117 ], [ -8.505784007725754, 115.61211502918539 ], [ -8.517241999218868, 115.58102102699885 ], [ -8.500915005323247, 115.52998101331322 ], [ -8.51301699323966, 115.50815902142176 ], [ -8.540357025556318, 115.50917900011083 ], [ -8.57060429984858, 115.4476627173606 ], [ -8.581008545807752, 115.35553201119339 ], [ -8.660108038655075, 115.2644180083845 ], [ -8.706696572788537, 115.26368661044876 ], [ -8.744262960667111, 115.18405701402006 ], [ -8.76464502644679, 115.18276103339511 ], [ -8.785554955596727, 115.2080880106532 ], [ -8.787132031917729, 115.22022601012237 ], [ -8.754404041613213, 115.22202500764809 ], [ -8.802967996875573, 115.24026696844591 ], [ -8.832791035777639, 115.2178969710684 ], [ -8.848048783424652, 115.12343955778942 ], [ -8.838201051437363, 115.08885898025781 ], [ -8.821249332690513, 115.0851926043553 ], [ -8.779572986404201, 115.16395797568008 ], [ -8.759387042977636, 115.16856299198854 ], [ -8.744300733092299, 115.15197426300189 ], [ -8.721988991998327, 115.16926001603706 ], [ -8.675102018743182, 115.14630697108987 ], [ -8.640215982881301, 115.09945300655102 ], [ -8.59587103242215, 115.0725480275695 ], [ -8.476612031220217, 114.93364801814161 ], [ -8.412826027798921, 114.7996860089022 ], [ -8.396090992605217, 114.73224301310461 ], [ -8.4075779764425, 114.6230170267145 ], [ -8.388465587916556, 114.56750830516424 ], [ -8.219017478273923, 114.44815947158237 ], [ -8.16545062234831, 114.43318701586819 ], [ -8.180865379033982, 114.44233679390804 ], [ -8.178075960836846, 114.45149542667266 ], [ -8.166715320055935, 114.45885957470963 ], [ -8.166048389121901, 114.47055915378203 ], [ -8.157619247730093, 114.44493465920719 ], [ -8.118843036976482, 114.43225521480628 ], [ -8.094735239139979, 114.43881219612605 ], [ -8.093754543737138, 114.48905073040689 ], [ -8.13378133014427, 114.52260400517085 ], [ -8.154581715573713, 114.52219556187575 ], [ -8.131109682665734, 114.55507912590102 ], [ -8.143434817562774, 114.56251688884345 ], [ -8.141166035783883, 114.56843675894939 ], [ -8.132009586573126, 114.56176933009058 ], [ -8.120884357726872, 114.57990064459912 ], [ -8.13963439411199, 114.59500192190129 ], [ -8.122912104110299, 114.61802143124406 ], [ -8.196251049846033, 114.86785965080226 ], [ -8.175615478671368, 115.0012852621052 ], [ -8.081251643448535, 115.11635326429175 ], [ -8.061683489301526, 115.18375831229633 ] ] ] ];

        // const ntbPath = ;

        const baliPath = [[[[-8.100002,114.519701],[-8.095996,114.503341],[-8.092949,114.524537],[-8.100002,114.519701]],[[-8.746994,115.234823],[-8.750259,115.224802],[-8.743982,115.218828],[-8.729553,115.224463],[-8.721596,115.237886],[-8.729054,115.244832],[-8.735112,115.238011],[-8.730306,115.250894],[-8.742084,115.240437],[-8.741479,115.226853],[-8.746994,115.234823]],[[-8.762691,115.486108],[-8.745983,115.465669],[-8.745084,115.451275],[-8.720702,115.449327],[-8.673648,115.490757],[-8.671937,115.559462],[-8.686277,115.579262],[-8.705585,115.584703],[-8.746245,115.619169],[-8.769948,115.628524],[-8.790472,115.606795],[-8.805681,115.605966],[-8.818415,115.58463],[-8.795751,115.528274],[-8.762691,115.486108]],[[-8.698163,115.448016],[-8.687595,115.462891],[-8.71207,115.443046],[-8.703833,115.439776],[-8.698163,115.448016]],[[-8.694394,115.443789],[-8.686238,115.428416],[-8.676185,115.446912],[-8.664763,115.449104],[-8.66811,115.47115],[-8.67866,115.46959],[-8.694394,115.443789]],[[-8.4374,114.84339],[-8.432518,114.821486],[-8.410978,114.794165],[-8.396411,114.734743],[-8.407292,114.634207],[-8.398087,114.581884],[-8.345168,114.541866],[-8.333988,114.522272],[-8.307139,114.517942],[-8.277295,114.485064],[-8.216348,114.447341],[-8.164278,114.434385],[-8.165519,114.441367],[-8.184574,114.442029],[-8.17115,114.457049],[-8.176159,114.456827],[-8.166795,114.476608],[-8.154677,114.444781],[-8.122099,114.434948],[-8.096681,114.436513],[-8.094115,114.490689],[-8.134108,114.523137],[-8.151317,114.512537],[-8.154872,114.523551],[-8.132246,114.553798],[-8.141847,114.566749],[-8.131447,114.562063],[-8.120277,114.584266],[-8.123687,114.594585],[-8.129896,114.587177],[-8.138359,114.592946],[-8.127895,114.625922],[-8.143891,114.656939],[-8.144508,114.694024],[-8.169044,114.748952],[-8.196381,114.862509],[-8.183942,114.909479],[-8.176741,114.997748],[-8.143521,115.048766],[-8.108531,115.079064],[-8.084338,115.114443],[-8.06475,115.156895],[-8.062932,115.188292],[-8.104605,115.29419],[-8.111225,115.336079],[-8.128468,115.357843],[-8.161353,115.450883],[-8.231051,115.557343],[-8.325249,115.631101],[-8.357971,115.696296],[-8.387833,115.711127],[-8.424704,115.694045],[-8.462182,115.634183],[-8.506045,115.610893],[-8.516406,115.582244],[-8.500749,115.53836],[-8.503693,115.522299],[-8.515505,115.507608],[-8.529241,115.514782],[-8.541294,115.507888],[-8.555626,115.462549],[-8.570559,115.445048],[-8.576564,115.363778],[-8.62168,115.305636],[-8.663952,115.261574],[-8.692128,115.266987],[-8.709461,115.25958],[-8.714212,115.227979],[-8.726266,115.213876],[-8.746504,115.211341],[-8.746052,115.206238],[-8.718674,115.209689],[-8.734547,115.187108],[-8.723789,115.186571],[-8.727001,115.182349],[-8.777463,115.177926],[-8.771853,115.184711],[-8.790192,115.221144],[-8.766461,115.215688],[-8.75306,115.220699],[-8.801818,115.236928],[-8.834445,115.213667],[-8.848983,115.167963],[-8.845527,115.112635],[-8.838145,115.088811],[-8.828206,115.084838],[-8.8139,115.090478],[-8.804782,115.114122],[-8.791705,115.12346],[-8.777464,115.165854],[-8.760548,115.1689],[-8.750457,115.152459],[-8.71444,115.167508],[-8.674591,115.145853],[-8.643644,115.104573],[-8.581383,115.059414],[-8.477357,114.934927],[-8.4374,114.84339]]]];

        const denpasarPath = [ [ [ [ -8.735726739697185, 115.21395685772295 ], [ -8.7467070382991, 115.21176702832575 ], [ -8.738045968046908, 115.20786987469502 ], [ -8.741422978987217, 115.20053993417069 ], [ -8.72902617711631, 115.21723099701295 ], [ -8.735726739697185, 115.21395685772295 ] ] ], [ [ [ -8.72337403068693, 115.23389600199889 ], [ -8.724296026440452, 115.23259296799117 ], [ -8.72376096309793, 115.23159703537497 ], [ -8.72312803912763, 115.23371402778025 ], [ -8.72337403068693, 115.23389600199889 ] ] ], [ [ [ -8.721402429878182, 115.23951372507841 ], [ -8.729052396850605, 115.24480802586977 ], [ -8.7369997966033, 115.23642042596191 ], [ -8.728305246389905, 115.24755630278116 ], [ -8.731082076776335, 115.25065436110997 ], [ -8.743866920821723, 115.23699863517895 ], [ -8.734930012310187, 115.22940397741175 ], [ -8.746779858203872, 115.23473009621702 ], [ -8.752062260964504, 115.2298522013181 ], [ -8.748183740387265, 115.21837130229382 ], [ -8.731689910560885, 115.22191015522958 ], [ -8.721402429878182, 115.23951372507841 ] ] ], [ [ [ -8.59153955840382, 115.2350164448532 ], [ -8.63217007678763, 115.25557466803666 ], [ -8.650443024625858, 115.27488099266374 ], [ -8.665629045044358, 115.26145498955624 ], [ -8.704308967185064, 115.26459402279598 ], [ -8.739038056061403, 115.18876381289968 ], [ -8.70696608341797, 115.18756198859498 ], [ -8.682325727750122, 115.17250843741455 ], [ -8.674896548836646, 115.17975179930616 ], [ -8.661854480699631, 115.1734298683938 ], [ -8.660080290073306, 115.1805350359632 ], [ -8.61619746074414, 115.18019297612497 ], [ -8.611896874840834, 115.19739969673864 ], [ -8.60502057124231, 115.19675435582896 ], [ -8.596174214568268, 115.21172426736112 ], [ -8.59153955840382, 115.2350164448532 ] ] ] ];

        const gianyarPath = [ [ [ [ -8.314699769978322, 115.25725460881328 ], [ -8.332843308971487, 115.26247789733712 ], [ -8.31493447594525, 115.28323141100088 ], [ -8.317561124046584, 115.29073280637394 ], [ -8.338205709126072, 115.29493500644548 ], [ -8.328719578345805, 115.30665140643738 ], [ -8.33686045014959, 115.31563397083119 ], [ -8.33051578437594, 115.32817575510703 ], [ -8.366895216441055, 115.32474161743173 ], [ -8.369482006589273, 115.3364454152238 ], [ -8.384259426331457, 115.33683322087654 ], [ -8.413642241696078, 115.33106994072521 ], [ -8.433666903404795, 115.3174638933441 ], [ -8.464916210414746, 115.32699088122419 ], [ -8.49061162102938, 115.32398346736313 ], [ -8.52372394200625, 115.33636374688949 ], [ -8.524276049300177, 115.36019054795551 ], [ -8.567121487266753, 115.37101071237454 ], [ -8.57487698968125, 115.3710549734084 ], [ -8.650443024625858, 115.27488099266374 ], [ -8.609131508112604, 115.24333464407854 ], [ -8.566021882603785, 115.24915560764525 ], [ -8.525172309154687, 115.2299024248571 ], [ -8.477916044589744, 115.24481198108815 ], [ -8.444887351569967, 115.2296083654338 ], [ -8.391219037728419, 115.22531794906408 ], [ -8.357822431160216, 115.23443328217026 ], [ -8.338414540698462, 115.24931204471513 ], [ -8.321775107035538, 115.24499967679371 ], [ -8.314699769978322, 115.25725460881328 ] ] ] ];

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: -2.5489, lng: 118.0149 },
                zoom: 5,
            });

            $(document).ready(function () {
                // Initialize Select2
                $('#provinsi_id').select2();
                $('#kabupaten_id').select2();

                // Province selection change handler
                $('#provinsi_id').on('change', function () {
                    var provinsiId = $(this).val();

                    // Clear previous layers
                    if (provinsiLayer) {
                        provinsiLayer.setMap(null);
                    }
                    if (kabupatenLayer) {
                        kabupatenLayer.setMap(null);
                    }
                    // Clear kabupaten select
                    $('#kabupaten_id').val(null).trigger('change');
                    $('#kabupaten_id').prop('disabled', !provinsiId);

                    if (provinsiId) {
                        const geojson = convertPathToGeoJSON(baliPath);
                        if (geojson) {
                            // Add province layer
                            provinsiLayer = new google.maps.Data({ map: map });
                            provinsiLayer.addGeoJson(geojson);
                            provinsiLayer.setStyle({
                                fillColor: '#2563eb',
                                fillOpacity: 0.2,
                                strokeColor: '#2563eb',
                                strokeWeight: 2
                            });
                            // Fit map to province bounds
                            const bounds = new google.maps.LatLngBounds();
                            geojson.geometry.coordinates.forEach(polygon => {
                                polygon.forEach(ring => {
                                    ring.forEach(coord => {
                                        bounds.extend(new google.maps.LatLng(coord[ 1 ], coord[ 0 ]));
                                    })
                                })
                            });
                            map.fitBounds(bounds);
                            // Clear kabupaten Layer
                            if (kabupatenLayer) {
                                kabupatenLayer.setMap(null)
                            }
                        }
                    }
                });

                // Kabupaten selection change handler
                $('#kabupaten_id').on('change', function () {
                    var kabupatenId = $(this).val();

                    if (kabupatenLayer) {
                        kabupatenLayer.setMap(null);
                    }
                    if (kabupatenId == 5171) {
                        const geojson = convertPathToGeoJSON(denpasarPath)
                        if (geojson) {
                            // Add kabupaten layer
                            kabupatenLayer = new google.maps.Data({ map: map });
                            kabupatenLayer.addGeoJson(geojson);
                            kabupatenLayer.setStyle({
                                fillColor: '#dc2626',
                                fillOpacity: 0.4,
                                strokeColor: '#dc2626',
                                strokeWeight: 2
                            });
                            const bounds = new google.maps.LatLngBounds();
                            geojson.geometry.coordinates.forEach(polygon => {
                                polygon.forEach(ring => {
                                    ring.forEach(coord => {
                                        bounds.extend(new google.maps.LatLng(coord[ 1 ], coord[ 0 ]));
                                    })
                                })
                            });
                            map.fitBounds(bounds);
                        }
                    }
                    else {
                        const geojson = convertPathToGeoJSON(gianyarPath)
                        if (geojson) {
                            // Add kabupaten layer
                            kabupatenLayer = new google.maps.Data({ map: map });
                            kabupatenLayer.addGeoJson(geojson);
                            kabupatenLayer.setStyle({
                                fillColor: '#dc2626',
                                fillOpacity: 0.4,
                                strokeColor: '#dc2626',
                                strokeWeight: 2
                            });
                            const bounds = new google.maps.LatLngBounds();
                            geojson.geometry.coordinates.forEach(polygon => {
                                polygon.forEach(ring => {
                                    ring.forEach(coord => {
                                        bounds.extend(new google.maps.LatLng(coord[ 1 ], coord[ 0 ]));
                                    })
                                })
                            });
                            map.fitBounds(bounds);
                        }
                    }
                });
            })
        }
    </script>
</body>

</html>